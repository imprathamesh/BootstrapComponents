@typeparam TItem

<div class="gantt-chart" style="--row-month:@TotalDays">
    @Header
    <div class="gantt-body">

        @foreach (var item in Items)
        {
            <div class="gantt-task-name">
                @TaskName(item)
            </div>

            @for (var i = 0; i < TotalDays; i++)
            {
                if (i == StartOffset(item))
                {
                    <div class="gantt-task-bar" data-bs-toggle="tooltip" data-bs-html="true"
                         title="@Tooltip(item)" style="grid-column: span @(Duration(item));background-color:@BarColor(item)">
                    </div>

                    i += Duration(item) - 1; // ✅ critical
                }
                else
                {
                    <div class="gantt-task"></div>
                }
            }
        }

        <div class="today-line" style="grid-column:@TodayColumn"></div>
    </div>
</div>

@code {
    [Parameter] public IEnumerable<TItem> Items { get; set; } = new List<TItem>();
    [Parameter] public RenderFragment Header { get; set; } = default!;

    [Parameter] public Func<TItem, string> TaskName { get; set; } = default!;
    [Parameter] public Func<TItem, int> StartOffset { get; set; } = default!;
    [Parameter] public Func<TItem, int> Duration { get; set; } = default!;
    [Parameter] public Func<TItem, string> BarColor { get; set; } = default!;
    [Parameter] public Func<TItem, string> Tooltip { get; set; } = default!;

    [Parameter] public DateTime StartDate { get; set; }
    [Parameter] public DateTime EndDate { get; set; }

    int TotalDays => (EndDate - StartDate).Days + 1;

    int TodayColumn =>
        DateTime.Today < StartDate || DateTime.Today > EndDate
            ? -1
            : (DateTime.Today - StartDate).Days + 2;
}

